<mat-toolbar color="primary" class="toolbar">
  <button mat-icon-button (click)="goBack()">
    <mat-icon>arrow_back</mat-icon>
  </button>
  <span class="toolbar-title">Find a Therapist</span>
  <span class="spacer"></span>
  @if (user(); as user) {
    <span class="user-name">{{ user.firstName }}</span>
  }
  <button mat-icon-button (click)="logout()" aria-label="Logout">
    <mat-icon>logout</mat-icon>
  </button>
</mat-toolbar>

<div class="container">
  <!-- Search Section -->
  <mat-card class="search-card">
    <mat-card-content>
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search therapists</mat-label>
        <input
          matInput
          [formControl]="searchControl"
          placeholder="Search by name, specialization, or keywords..."
        >
        <mat-icon matPrefix>search</mat-icon>
        @if (searchControl.value) {
          <button
            matSuffix
            mat-icon-button
            (click)="searchControl.setValue('')"
            aria-label="Clear search"
          >
            <mat-icon>close</mat-icon>
          </button>
        }
      </mat-form-field>
    </mat-card-content>
  </mat-card>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Loading therapists...</p>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <mat-card class="error-card">
      <mat-card-content>
        <div class="error-content">
          <mat-icon color="warn">error</mat-icon>
          <p>{{ error() }}</p>
          <button mat-raised-button color="primary" (click)="loadTherapists()">
            Retry
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  }

  <!-- Results Section -->
  @if (!loading() && !error()) {
    <div class="results-header">
      <h2>
        @if (searchControl.value) {
          Found {{ filteredTherapists().length }} therapist(s)
        } @else {
          All Therapists ({{ filteredTherapists().length }})
        }
      </h2>
    </div>

    @if (filteredTherapists().length === 0) {
      <mat-card class="no-results-card">
        <mat-card-content>
          <div class="no-results-content">
            <mat-icon>search_off</mat-icon>
            <h3>No therapists found</h3>
            <p>Try adjusting your search criteria</p>
          </div>
        </mat-card-content>
      </mat-card>
    } @else {
      <div class="therapists-grid">
        @for (therapist of filteredTherapists(); track therapist.id) {
          <mat-card class="therapist-card">
            <mat-card-header>
              <div mat-card-avatar class="therapist-avatar">
                @if (therapist.avatar) {
                  <img [src]="therapist.avatar" [alt]="therapist.firstName">
                } @else {
                  <mat-icon>person</mat-icon>
                }
              </div>
              <mat-card-title>
                Dr. {{ therapist.firstName }} {{ therapist.lastName }}
              </mat-card-title>
              <mat-card-subtitle>
                {{ therapist.yearsOfExperience }} years of experience
              </mat-card-subtitle>
            </mat-card-header>

            <mat-card-content>
              <div class="specializations">
                @for (spec of therapist.specialization; track spec) {
                  <mat-chip>{{ spec }}</mat-chip>
                }
              </div>

              <p class="bio">{{ therapist.bio }}</p>

              <div class="therapist-details">
                <div class="detail-item">
                  <mat-icon>school</mat-icon>
                  <span>{{ therapist.education }}</span>
                </div>
                <div class="detail-item">
                  <mat-icon>attach_money</mat-icon>
                  <span>${{ therapist.hourlyRate }}/hour</span>
                </div>
              </div>
            </mat-card-content>

            <mat-card-actions>
              <button
                mat-button
                color="primary"
                (click)="viewTherapistDetails(therapist.id)"
              >
                View Profile
              </button>
              <button
                mat-raised-button
                color="primary"
                (click)="bookAppointment(therapist.id)"
              >
                Book Appointment
              </button>
            </mat-card-actions>
          </mat-card>
        }
      </div>
    }
  }
</div>
